language: python

services:
  - postgresql

addons:
  postgresql: "9.6"
  apt:
    packages:
    - odbc-postgresql
    - unixodbc-dev

python:
  - "3.6"

install:
  - pip install flake8 pytest coverage "pytest-cov<2.6.0" codacy-coverage

before_script:
  - psql -c "CREATE DATABASE asu;" -U postgres
  - psql -c "ALTER USER postgres WITH PASSWORD 'changeme';" -U postgres
  - psql asu < ./asu/utils/tables.sql -U postgres

script:
  - pip install -e .
  - flake8 --exclude=asu/__init__.py
  - pytest -c pytest.ini -cov=asu
  - python3 -m coverage xml
  - python3 -m codacy -r coverage.xml
